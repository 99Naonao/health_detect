import{b as e,f as t,g as s,a5 as n,n as i,A as o,i as l,w as a,j as r,o as u,k as c,C as d,l as p,t as h,I as C,K as f,L as g,M as y,p as w,v as m,J as S,a6 as I,a7 as D}from"./index-CRXElb8Q.js";import{_ as q}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=q({data:()=>({userInfoT:{},showIntro:!0,questions:[{id:1,index:1,userId:"",pch:0,type:"input",questionContent:"近1个月，晚上上床睡觉通常(   )点钟"},{id:2,index:2,userId:"",pch:0,type:"input",questionContent:"近1个月，从上床到入睡通常需要(   )分钟"},{id:3,index:3,userId:"",pch:0,type:"input",questionContent:"近1个月，通常早上(   )点起床"},{id:4,index:4,userId:"",pch:0,type:"input",questionContent:"近1个月，每夜通常实际睡眠(   )小时（不等于卧床时间）"},{id:5,index:5,userId:"",pch:0,type:"choice",questionContent:"入睡困难(30分钟内不能入睡)",options:["A.无","B.<1次/周","C.1~2次/周","D.≥3次/周"]},{id:6,index:6,userId:"",pch:0,type:"choice",questionContent:"夜间易醒或早醒",options:["A.无","B.<1次/周","C.1~2次/周","D.≥3次/周"]},{id:7,index:7,userId:"",pch:0,type:"choice",questionContent:"夜间去厕所",options:["A.无","B.<1次/周","C.1~2次/周","D.≥3次/周"]},{id:8,index:8,userId:"",pch:0,type:"choice",questionContent:"呼吸不畅",options:["A.无","B.<1次/周","C.1~2次/周","D.≥3次/周"]},{id:9,index:9,userId:"",pch:0,type:"choice",questionContent:"咳嗽或鼾声高",options:["A.无","B.<1次/周","C.1~2次/周","D.≥3次/周"]},{id:10,index:10,userId:"",pch:0,type:"choice",questionContent:"感觉冷",options:["A.无","B.<1次/周","C.1~2次/周","D.≥3次/周"]},{id:11,index:11,userId:"",pch:0,type:"choice",questionContent:"感觉热",options:["A.无","B.<1次/周","C.1~2次/周","D.≥3次/周"]},{id:12,index:12,userId:"",pch:0,type:"choice",questionContent:"做噩梦",options:["A.无","B.<1次/周","C.1~2次/周","D.≥3次/周"]},{id:13,index:13,userId:"",pch:0,type:"choice",questionContent:"疼痛不适",options:["A.无","B.<1次/周","C.1~2次/周","D.≥3次/周"]},{id:14,index:14,userId:"",pch:0,type:"choice",questionContent:"其他影响睡眠的事情",options:["A.无","B.<1次/周","C.1~2次/周","D.≥3次/周"]},{id:15,index:15,userId:"",pch:0,type:"choice",questionContent:"近1个月，总的来说，您认为自己的睡眠质量",options:["A.很好","B.较好","C.较差","D.很差"]},{id:16,index:16,userId:"",pch:0,type:"choice",questionContent:"近1个月，您用药物催眠的情况",options:["A.无","B.<1次/周","C.1~2次/周","D.≥3次/周"]},{id:17,index:17,userId:"",pch:0,type:"choice",questionContent:"近1个月，您常感到困倦吗",options:["A.无","B.<1次/周","C.1~2次/周","D.≥3次/周"]},{id:18,index:18,userId:"",pch:0,type:"choice",questionContent:"近1个月，您做事情的精力不足吗",options:["A.没有","B.偶尔有","C.有时有","D.经常有"]}],answers:{},userScaleConclusionDto:{pch:0,userId:"",score:"",conclusion:""},page:0,pageSize:4,conclusion:[{Content:"恭喜您！您的睡眠质量为1度，就像小天使一样完美，请继续保持！可以使用我们眠加AI活力健康检测，对身心健康进行更全面的检测哦！"},{Content:"还不错！您的睡眠质量为2度，但可以更甜哦～建议使用我们的翼合枕和蚕丝被（待定），帮你提升睡眠舒适度哦！"},{Content:"很一般，您的睡眠质量为3度，需要一点点关爱啦！建议使用我们的甜睡保健贴和天然助眠精油（待定），帮您睡得更甜哦！"},{Content:"有点糟糕，您的睡眠质量为4度，快给睡眠充充电吧！建议使用我们的古法舒睡仪，来专业改善睡眠质量。如果您有想咨询专业医师的需要，可以添加下方的专属睡眠管家，我们可以免费帮您精准找到适合您睡眠状况的医疗资源哦！"}],otherSleepDesc:""}),computed:{totalPages(){return Math.ceil(this.questions.length/this.pageSize)},currentQuestions(){const e=this.page*this.pageSize;return this.questions.slice(e,e+this.pageSize)},sleepScore(){const e=this.answers[15];return 0===e?0:1===e?1:2===e?2:3===e?3:"-"},sleepTimeScore(){let e=this.answers[2],t=null;if(null!=e&&""!==e){let s=parseInt(e);isNaN(s)||(t=s<=15?0:s<=30?1:s<=60?2:3)}let s=this.answers[5],n=null;if(0===s?n=0:1===s?n=1:2===s?n=2:3===s&&(n=3),null===t||null===n)return"-";let i=t+n;return 0===i?0:i>=1&&i<=2?1:i>=3&&i<=4?2:i>=5&&i<=6?3:"-"},sleepDurationScore(){let e=this.answers[4];if(null!=e&&""!==e){let t=parseFloat(e);if(!isNaN(t)){if(t>7)return 0;if(t>=6&&t<=7)return 1;if(t>=5&&t<6)return 2;if(t<5)return 3}}return"-"},sleepEfficiencyScore(){let e=this.answers[1],t=this.answers[3],s=this.answers[4];if(!e||!t||!s)return"-";function n(e){if(!e)return null;let t=e.split(":");if(t.length<2)return null;let s=parseInt(t[0]),n=parseInt(t[1]);return isNaN(s)||isNaN(n)?null:s+n/60}let i=n(e),o=n(t),l=parseFloat(s);if(null===i||null===o||isNaN(l))return"-";let a=o-i;if(a<=0&&(a+=24),a<=0)return"-";let r=l/a*100;return isNaN(r)?"-":r>85?0:r>=75&&r<=84?1:r>=65&&r<75?2:r<65?3:"-"},sleepDisorderScore(){let e=0;for(let s=6;s<=13;s++){let t=this.answers[s];0===t?e+=0:1===t?e+=1:2===t?e+=2:3===t&&(e+=3)}let t=this.answers[14];return t&&""!==String(t).trim()&&(e+=1),0===e?0:e>=1&&e<=9?1:e>=10&&e<=18?2:e>=19&&e<=27?3:"-"},hypnoticScore(){let e=this.answers[16];return 0===e?0:1===e?1:2===e?2:3===e?3:"-"},daytimeDysfunctionScore(){let e=this.answers[17],t=null;0===e?t=0:1===e?t=1:2===e?t=2:3===e&&(t=3);let s=this.answers[18],n=null;if(0===s?n=0:1===s?n=1:2===s?n=2:3===s&&(n=3),null===t||null===n)return"-";let i=t+n;return 0===i?0:i>=1&&i<=2?1:i>=3&&i<=4?2:i>=5&&i<=6?3:"-"},psqiTotalScore(){const e=[this.sleepScore,this.sleepTimeScore,this.sleepDurationScore,this.sleepEfficiencyScore,this.sleepDisorderScore,this.hypnoticScore,this.daytimeDysfunctionScore];return e.includes("-")?"-":e.reduce(((e,t)=>e+t),0)},completedCount(){return this.questions.filter((e=>{const t=this.answers[e.id];return 14===e.id||null!=t&&""!==t})).length}},onLoad(){this.Usercentre()},methods:{startTest(){this.showIntro=!1},selectChoice(e,t){this.$set(this.answers,e,t)},Usercentre(){e().then((e=>{console.log("res.999",e),this.userInfoT=e}))},nextPage(){this.page<this.totalPages-1&&this.page++,this.$nextTick((()=>{this.$refs.resultView.scrollTo({top:0,behavior:"smooth"})}))},prevPage(){this.page>0&&this.page--,this.$nextTick((()=>{this.$refs.resultView.scrollTo({top:0,behavior:"smooth"})}))},submit(){const e=[];if(this.questions.forEach((t=>{const s=this.answers[t.id];null!=s&&""!==s||e.push(t.index)})),void 0!==this.answers[14]&&0!==this.answers[14]&&(!this.otherSleepDesc||""===this.otherSleepDesc.trim()))return void t({title:"提示",content:"第14题，请填写具体说明",showCancel:!1});if(e.length>0)return void t({title:"提示",content:`第${e.join("、")}题尚未作答，请完成所有题目后再提交`,showCancel:!1});this.questions.forEach((e=>{const t=this.answers[e.id];void 0!==t&&("choice"===e.type?e.answer=e.options[t]:e.answer=t),e.userId=this.userInfoT.id}));let l=this.psqiTotalScore,a=-1;"number"==typeof l&&(l>=0&&l<=5?a=0:l>=6&&l<=10?a=1:l>=11&&l<=15?a=2:l>=16&&l<=21&&(a=3)),this.userScaleConclusionDto.conclusion=-1!==a?this.conclusion[a].Content:"",this.userScaleConclusionDto.userId=this.userInfoT.id,this.userScaleConclusionDto.score=this.psqiTotalScore;const r=this.questions.map((({id:e,...t})=>t));let u=s("test_id");this.userScaleConclusionDto.result_id=u,n({userScaleDetailDtos:r,userScaleConclusionDto:this.userScaleConclusionDto}).then((e=>{console.log("res.res:11",e),e?i({url:"/pages/healthtest/Newconclusion?numtolt="+this.psqiTotalScore+"&conclusionid="+e.data.id}):o({title:e.msg||"请重试",icon:"none"})}))},getPlaceholder:e=>1===e?"请选择时间":2===e?"请输入分钟数":3===e?"请选择时间":4===e?"请输入小时数":14===e?"选填，如无其他情况可不填":"请输入答案",onTimeChange(e,t){this.answers[t]=e.detail.value},validateInput(e,t){const s=e.detail.value;2!==t&&4!==t||(this.answers[t]=s.replace(/[^\d]/g,""))}}},[["render",function(e,t,s,n,i,o){const q=m,x=r,k=I,_=D;return u(),l(x,{class:"topic-container"},{default:a((()=>[c(x,null,{default:a((()=>[d("div",{class:"conttt",ref:"resultView",onScroll:t[1]||(t[1]=(...t)=>e.handleResultScroll&&e.handleResultScroll(...t))},[c(x,{class:"progress-bar"},{default:a((()=>[c(q,{class:"progress-text"},{default:a((()=>[p("第 "+h(i.page+1)+"/"+h(o.totalPages)+" 页",1)])),_:1}),c(x,{class:"progress-line"},{default:a((()=>[c(x,{class:"progress-inner",style:C({width:(i.page+1)/o.totalPages*100+"%"})},null,8,["style"])])),_:1})])),_:1}),(u(!0),f(y,null,g(o.currentQuestions,((e,s)=>(u(),l(x,{key:e.id,class:"question-block"},{default:a((()=>[c(x,{class:"question-title"},{default:a((()=>[p(h(e.index)+"、"+h(e.questionContent),1)])),_:2},1024),"input"===e.type?(u(),l(x,{key:0},{default:a((()=>[2===e.id||4===e.id?(u(),l(k,{key:0,class:"input-answer",modelValue:i.answers[e.id],"onUpdate:modelValue":t=>i.answers[e.id]=t,placeholder:o.getPlaceholder(e.id),type:"number",onInput:t=>o.validateInput(t,e.id)},null,8,["modelValue","onUpdate:modelValue","placeholder","onInput"])):1===e.id||3===e.id?(u(),l(_,{key:1,mode:"time",value:i.answers[e.id],onChange:t=>o.onTimeChange(t,e.id),class:"input-answer"},{default:a((()=>[c(x,{class:"picker-text"},{default:a((()=>[p(h(i.answers[e.id]||o.getPlaceholder(e.id)),1)])),_:2},1024)])),_:2},1032,["value","onChange"])):14===e.id?(u(),l(k,{key:2,class:"input-answer",modelValue:i.answers[e.id],"onUpdate:modelValue":t=>i.answers[e.id]=t,placeholder:o.getPlaceholder(e.id),type:"text"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):w("",!0),1===e.id||3===e.id?(u(),l(q,{key:3,class:"input-tip"},{default:a((()=>[p("请选择时间")])),_:1})):w("",!0),2===e.id?(u(),l(q,{key:4,class:"input-tip"},{default:a((()=>[p("请输入分钟数")])),_:1})):w("",!0),4===e.id?(u(),l(q,{key:5,class:"input-tip"},{default:a((()=>[p("请输入小时数")])),_:1})):w("",!0),14===e.id?(u(),l(q,{key:6,class:"input-tip"},{default:a((()=>[p("选填，如无其他情况可不填")])),_:1})):w("",!0)])),_:2},1024)):"choice"===e.type?(u(),l(x,{key:1},{default:a((()=>[c(x,{class:"choice-list"},{default:a((()=>[(u(!0),f(y,null,g(e.options,((t,s)=>(u(),l(x,{key:s,class:S(["choice-item",{selected:i.answers[e.id]===s}]),onClick:t=>o.selectChoice(e.id,s)},{default:a((()=>[p(h(t),1)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024),14===e.id&&0!==i.answers[14]&&void 0!==i.answers[14]?(u(),l(x,{key:0,style:{"margin-top":"10px"}},{default:a((()=>[c(k,{class:"input-answer",modelValue:i.otherSleepDesc,"onUpdate:modelValue":t[0]||(t[0]=e=>i.otherSleepDesc=e),placeholder:"请填写具体情况",type:"text"},null,8,["modelValue"])])),_:1})):w("",!0)])),_:2},1024)):w("",!0)])),_:2},1024)))),128))],544),c(x,{class:"page-btn-row"},{default:a((()=>[i.page>0?(u(),l(x,{key:0,class:"page-btn",onClick:o.prevPage},{default:a((()=>[p("上一页")])),_:1},8,["onClick"])):w("",!0),i.page<o.totalPages-1?(u(),l(x,{key:1,class:"page-btn main",onClick:o.nextPage},{default:a((()=>[p("下一页")])),_:1},8,["onClick"])):(u(),l(x,{key:2,class:"page-btn main",onClick:o.submit},{default:a((()=>[p("提交")])),_:1},8,["onClick"]))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-615600be"]]);export{x as default};
